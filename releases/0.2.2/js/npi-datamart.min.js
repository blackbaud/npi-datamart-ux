!function(){"use strict";angular.module("npi-datamart.api",[]).factory("BBDataMartAPI",["$q","$timeout","$http",function(a,b,c){var d=function(d){function e(){return a(function(a,b){d.dataMartId?a(d.dataMartId):d.getDataMartId().then(a)["catch"](b)})}function f(){return z.getDomain()}function g(){return y||(y=a(function(a,b){f().then(function(c){e().then(function(b){a({apiRoot:c,dataMartId:b})})["catch"](b)})["catch"](b)})),y}function h(){return a(function(a,b){z.ensureAuthenticated().then(function(){g().then(function(b){a(b)})["catch"](b)})["catch"](b)})}function i(b,e){return A[e]||(A[e]=a(function(a,f){function g(d){var e={identifierToUri:[d]};c.post(b.apiRoot+"/gdc/md/"+b.dataMartId+"/identifiers",e,{withCredentials:!0}).then(function(b){b.data&&b.data.identifiers&&b.data.identifiers[0]&&b.data.identifiers[0].uri?a(b.data.identifiers[0].uri):f()})["catch"](f)}d.translateObjectIdentifier?d.translateObjectIdentifier(e).then(function(a){g(a)})["catch"](f):g(e)})),A[e]}function j(b,d){return a(function(a,e){c.get(b.apiRoot+d,{withCredentials:!0}).then(function(b){b.data?a(b.data):e()})["catch"](e)})}function k(b,d,e){var f,g,h=null;return a(function(a,i){c.get(b.apiRoot+d+"?filter="+e,{withCredentials:!0}).then(function(b){if(b.data&&b.data.attributeElements&&b.data.attributeElements.elements){for(f=0;f<b.data.attributeElements.elements.length;f+=1)if(g=b.data.attributeElements.elements[f],g.title.toString()===e.toString()){h=g.uri;break}a(h)}a(null)})["catch"](i)})}function l(a){return d.translateAttributeName?d.translateAttributeName(a):a}function m(a){var b=null;return a&&(b=0===a.lastIndexOf("attr.",0)?a.replace("attr.","label."):"label."+a),b}function n(d,e,f){return a(function(a,g){c.get(d.apiRoot+e,{withCredentials:!0}).then(function(c){f||!c.data||c.data.xtab_data?a(c):b(function(){a(n(d,e,!1))},3e3)})["catch"](g)})}function o(b,d){return a(function(a,e){c.post(b.apiRoot+"/gdc/app/projects/"+b.dataMartId+"/execute",d,{withCredentials:!0}).then(function(c){c.data&&c.data.execResult&&c.data.execResult.dataResult?a(n(b,c.data.execResult.dataResult)):e()})["catch"](e)})}function p(b,c,d){var e,f,g={uri:d,constraint:{type:"list"}},h=[];return a(function(i){if(c.value){for(f=Array.isArray(c.value)?c.value:[c.value],e=0;e<f.length;e+=1)h.push(k(b,d+"/elements",f[e]));h.length>0?a.all(h).then(function(a){g.constraint.elements=a,i(g)}):i(null)}else i(null)})}function q(b,c){return a(function(e,f){function g(c){var d={};for(j=0;j<c.length;j+=1){if(h=c[j].attribute?m(l(c[j].attribute)):c[j].attributeDisplayForm,!h)throw new Error("Filter must have an attribute or attribute display form specified");k.push(i(b,h))}a.all(k).then(function(f){for(k=[],j=0;j<c.length;j+=1)c[j].value&&k.push(p(b,c[j],f[j]));k.length>0?a.all(k).then(function(a){a.length>0&&(d={filters:a}),e(d)}):e(null)})["catch"](f)}var h,j,k=[];c?d.translateFilters?d.translateFilters(c).then(g):g(c):e(null)})}function r(b,c,d){return a(function(e,f){a.all([i(b,c),q(b,d)]).then(function(a){var c={},d={},g=a[0],h=a[1];d.report=g,h&&(d.context=h),c.report_req=d,o(b,c).then(e)["catch"](f)})["catch"](f)})}function s(b,d){return a(function(a,e){function f(d){c.get(d,{withCredentials:!0}).then(function(c){c.data&&c.data.uri?f(b.apiRoot+c.data.uri):a(c)})["catch"](e)}c.post(b.apiRoot+"/gdc/app/projects/"+b.dataMartId+"/execute/raw",d,{withCredentials:!0}).then(function(c){c.data&&c.data.uri?f(b.apiRoot+c.data.uri):a(c)})["catch"](e)})}function t(a){var b,c=null;return a.data&&a.data.xtab_data&&a.data.xtab_data.data&&(b=a.data.xtab_data.data,b[0]&&b[0][0]&&(c=b[0][0])),c}function u(b,c){return a(function(a,d){i(b,c).then(function(c){j(b,c).then(function(c){c&&c.report&&c.report.content&&c.report.content.definitions?j(b,c.report.content.definitions.pop()).then(function(b){a(b)})["catch"](d):d()})["catch"](d)})["catch"](d)})}function v(b,c,d){return a(function(e,f){var g,h,j,k,l=[u(b,c),i(b,c)];d&&l.push(q(b,d)),a.all(l).then(function(a){k=a[0],k&&k.reportDefinition&&k.reportDefinition.content&&k.reportDefinition.content.grid&&k.reportDefinition.content.grid.metrics&&k.reportDefinition.content.grid.metrics[0]&&k.reportDefinition.content.grid.metrics[0].uri&&(j=k.reportDefinition.content.grid.metrics[0].uri,g=k.reportDefinition.content.grid.metrics[0].drillAcrossStepAttributeDF),h={reportUri:a[1],executionContext:{drillInto:{locators:[{metricLocator:{uri:j}}],target:g,targetType:"attributeDisplayForm"},filters:d&&a[2]?a[2].filters:null}},e(h)})["catch"](f)})}function w(b,c){return a(function(a,d){var e={report_req:{context:c.executionContext,report:c.reportUri}};s(b,e).then(function(b){var c,e=[];b.data?(c=b.data.replace(/"/g,"").split("\n"),c.shift(),angular.forEach(c,function(a){var b=a.split(",")[0];b&&e.push(b)}),a(e)):d()})["catch"](d)})}function x(){return a(function(a){f().then(function(b){c.get(b+"/gdc/ping",{withCredentials:!0}).then(function(){a(!0)})["catch"](function(){a(!1)})})})}var y,z,A={},B=this;if(d=d||{},z=d.authentication,!z)throw"An option for authentication must be provided.  This should be a BBDataMartAuthentication used to authenticate with the data mart API.";if(!d.dataMartId&&!d.getDataMartId)throw"An option for dataMartId or getDataMartId must be provided";B.platformIsAvailable=x,B.getObjectUriFromIdentifier=function(b){return a(function(a,c){h().then(function(d){i(d,b).then(a)["catch"](c)})["catch"](c)})},B.executeReport=function(b,c){return a(function(a,d){h().then(function(e){r(e,b,c).then(a)["catch"](d)})["catch"](d)})},B.getHeadlineReportData=function(b,c){return a(function(a,d){h().then(function(e){r(e,b,c).then(function(b){a(t(b))})["catch"](d)})["catch"](d)})},B.getHeadlineReportDrillContext=function(b,c){return a(function(a,d){h().then(function(e){v(e,b,c).then(a)["catch"](d)})["catch"](d)})},B.loadDrillInRecordIds=function(b){return a(function(a,c){h().then(function(d){w(d,b).then(a)["catch"](c)})["catch"](c)})},B.getLatestReportDefinition=function(b){return a(function(a,c){h().then(function(d){u(d,b).then(a)["catch"](c)})["catch"](c)})},B.getObjectDefinitionByUri=function(b){return a(function(a,c){h().then(function(d){j(d,b).then(a)["catch"](c)})["catch"](c)})}};return d}])}(),function(){"use strict";angular.module("npi-datamart.authentication",[]).factory("BBDataMartAuthentication",["$q","$http","$rootScope",function(a,b,c){var d=function(d){function e(){return a(function(a,b){d.domain?a(d.domain):d.getDomain().then(a)["catch"](b)})}function f(){return a(function(a,b){d.ssoProvider?a(d.ssoProvider):d.getSSOProvider().then(a)["catch"](b)})}function g(b){return a(function(c,g){var h=[d.getSSOToken(),e(),f()];a.all(h).then(function(a){var d,e,f,g;f=a[0],e=a[1],g=a[2],f&&g&&(d=e,d+="/gdc/account/customerlogin?sessionId=",d+=encodeURIComponent(f),d+="&serverURL=",d+=encodeURIComponent(g),d+="&targetURL=",d+=encodeURIComponent(b),c(d))})["catch"](g)})}function h(a){return a&&401===a.status}function i(){return a(function(a,c){e().then(function(d){var e=d+"/gdc/account/token";b.get(e,{withCredentials:!0}).then(function(){a()})["catch"](c)})["catch"](c)})}function j(){return a(function(a,c){g("/gdc/account/token").then(function(d){b.get(d,{withCredentials:!0}).then(function(){a()})["catch"](function(){i().then(function(){a()})["catch"](c)})})["catch"](c)})}function k(){return a(function(a,b){i().then(function(){a()})["catch"](function(c){h(c)?j().then(function(){a()})["catch"](b):b(c)})})}function l(){return n||(n=a(function(a,b){var d;o?d=k():(o=!0,d=j()),d.then(function(){var b,d=(new Date).getTime()+48e4;b=setInterval(function(){(new Date).getTime()>d&&(clearInterval(b),n=null,p>0&&c.$apply(function(){l()}))},1e3),a()})["catch"](function(a){n=null,b(a)})})),n}function m(b){return p+=1,b.$on("$destroy",function(){p-=1}),a(function(a,b){l().then(function(){a()})["catch"](b)})}var n,o,p=0,q=this;if(d=d||{},!d.domain&&!d.getDomain)throw"An option for domain or getDomain must be provided";if(!d.ssoProvider&&!d.getSSOProvider)throw"An option for ssoProvider or getSSOProvider must be provided";if(!d.getSSOToken)throw"An option for getSSOToken must be provided.  This should be a function returning a promise for an SSO token to be used to authenticate with the data mart API.";q.getDomain=e,q.ensureAuthenticated=l,q.maintainAuthentication=m};return d}])}(),function(){"use strict";var a=["npi-datamart.authentication","npi-datamart.api"];angular.module("npi-datamart",a)}(),angular.module("npi-datamart.templates",[]).run(["$templateCache",function(a){}]);
//# sourceMappingURL=npi-datamart.min.js.map